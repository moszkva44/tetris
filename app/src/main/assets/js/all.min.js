var globals={matrix:[],i:null,t:null,o:{dimensions:{},elements:{}},u:["I","T","O","J","L","S","Z"],l:["H","X","U","D","1","2","/"],h:[400,380,360,340,320,300,275,250,225,200,175,150,125,120,115,100],g:[0,2,2,3,3,4,4,5,5,6,6,7,7,8,9,9,10]};function ShapeFinder(i,n=[],t=[]){this.M=n,this.m=t,this.v=[],this.p=i}globals.o.elements={S:!1,A:!1,_:!1,k:!1,B:!1,O:!1,P:!1,F:!1,R:!1,D:!1,G:!1,I:!1,V:!1,T:!1,C:!1,j:!1},globals.o.dimensions={blockSize:-1,N:4,L:-1,H:-1,W:-1,U:60,$:12,q:-1,J:7,Y:-1,Z:-1,X:100,K:-1,ii:-1},ShapeFinder.prototype.ni=function(i){-1==this.M.indexOf(i)&&this.M.push(i)},ShapeFinder.prototype.ti=function(i){-1==this.m.indexOf(i)&&this.m.push(i)},ShapeFinder.prototype.ei=function(i){var n=!0,t=this.ai(i.x,i.y),e=!1;t.forEach(function(i){23==i.x?n=!1:1==globals.matrix.get()[i.x+1][i.y]&&globals.matrix.get()[i.x+1][i.y].oi()!=i.ri.oi()&&(e=!(n=!1))}),t.push(i),this.ti(t),n&&this.p.push(ShapeFactory.ui(t,!0)),e&&this.ni(t)},ShapeFinder.prototype.si=function(){var t=[],e=this;return this.m.forEach(function(i,n){i.forEach(function(i){e.v[i.x+":"+i.y]=n})}),this.M.forEach(function(i){if(-1==t.indexOf(i)){let n=e.ci(i);n&&0<n.length&&(t.push(n[0]),n.slice(1).forEach(function(i){Array.prototype.push.apply(n[0],i),t.push(i)}),i=ShapeFactory.ui(n[0],!0),-1==e.p.indexOf(i))&&0<t.length&&e.p.push(i)}}),this.p},ShapeFinder.prototype.li=function(i){var t=!1;return i.forEach(function(i,n){23==i.x&&(t=!0)}),t},ShapeFinder.prototype.ci=function(i,e=[]){if(this.li(i))return!1;-1==e.indexOf(i)&&e.push(i);var a=this;return i.forEach(function(i){var n,t;!1!==e&&1==globals.matrix.get()[i.x+1][i.y]&&globals.matrix.get()[i.x+1][i.y].oi()!=i.ri.oi()&&(-1==(n=void 0!==a.v[i.x+1+":"+i.y]?a.v[i.x+1+":"+i.y]:-1)?(t=a.ai(i.x+1,i.y)).push(new PositionedBrick(globals.matrix.get()[i.x+1][i.y],new Position(i.x+1,i.y))):t=a.m[n],-1==e.indexOf(t))&&(e=a.ci(t,e))}),e},ShapeFinder.prototype.hi=function(i,n){return i.some(function(i){return i.x==n.x&&i.y==n.y})},ShapeFinder.prototype.ai=function(i,n,t=[]){var e;return 0<n&&1==globals.matrix.get()[i][n-1]&&globals.matrix.get()[i][n-1].oi()==globals.matrix.get()[i][n].oi()&&(e=new PositionedBrick(globals.matrix.get()[i][n-1],new Position(i,n-1)),this.hi(t,e)||(t.push(e),t=this.ai(i,n-1,t))),n<9&&1==globals.matrix.get()[i][n+1]&&globals.matrix.get()[i][n+1].oi()==globals.matrix.get()[i][n].oi()&&(e=new PositionedBrick(globals.matrix.get()[i][n+1],new Position(i,n+1)),this.hi(t,e)||(t.push(e),t=this.ai(i,n+1,t))),0<i&&1==globals.matrix.get()[i-1][n]&&globals.matrix.get()[i-1][n].oi()==globals.matrix.get()[i][n].oi()&&(e=new PositionedBrick(globals.matrix.get()[i-1][n],new Position(i-1,n)),this.hi(t,e)||(t.push(e),t=this.ai(i-1,n,t))),i<23&&1==globals.matrix.get()[i+1][n]&&globals.matrix.get()[i+1][n].oi()==globals.matrix.get()[i][n].oi()&&(e=new PositionedBrick(globals.matrix.get()[i+1][n],new Position(i+1,n)),this.hi(t,e)||(t.push(e),t=this.ai(i+1,n,t))),t},ShapeFinder.prototype.gi=function(n){var t=!1;return this.p.forEach(function(i){i.fi(n.ri)&&(t=!0)}),t};var MoveRegister={Mi:[],add:function(i,n,t,e=10){MoveRegister.Mi.push({x:i,y:n,direction:t,count:e})},reset:function(){MoveRegister.Mi=[]},remove:function(t,e){var a=[];MoveRegister.Mi.forEach(function(i,n){i.x==t&&i.y==e&&a.push(n)}),a.forEach(function(i){MoveRegister.Mi.splice(i,1)})},get:function(n,t){var e=!1;return MoveRegister.Mi.forEach(function(i){i.x==n&&i.y==t&&0<i.count&&(e=i)}),e},di:function(t,e){var a=-1;MoveRegister.Mi.forEach(function(i,n){i.x==t&&i.y==e&&(MoveRegister.Mi[n].count=MoveRegister.Mi[n].count-1,a=n)}),-1<a&&0==MoveRegister.Mi[a].count&&MoveRegister.Mi.splice(a,1)}};function FloatingScore(i=0,n=0){this.mi=i,this.line=n,this.opacity=1,this.y=n*ui.dimensions.blockSize-ui.dimensions.blockSize/2,this.dy=-1}function Position(i,n){this.x=i,this.y=n}function Dimension(i,n,t){this.position=i,this.width=n,this.height=t}FloatingScore.prototype.bi=function(i){0<this.mi&&0<this.line&&(this.y=this.y+this.dy,i.font="20px Terminal bold",i.fillStyle="rgba(255, 255, 255, "+this.opacity+")",i.fillText("+"+this.mi,4*ui.dimensions.blockSize,this.y),this.opacity=this.opacity-this.opacity/120)},Object.defineProperty(Dimension.prototype,"x",{get:function(){return this.position.x}}),Object.defineProperty(Dimension.prototype,"y",{get:function(){return this.position.y}}),Object.defineProperty(Dimension.prototype,"x1",{get:function(){return this.position.x}}),Object.defineProperty(Dimension.prototype,"y1",{get:function(){return this.position.y}}),Object.defineProperty(Dimension.prototype,"x2",{get:function(){return this.position.x+this.width}}),Object.defineProperty(Dimension.prototype,"y2",{get:function(){return this.position.y+this.height}});var CascadeManager={p:[],wi:function(){return CascadeManager.p},vi:function(i=!1){if(globals.t.pi()&&globals.t.Ai().Si())return!1;for(var e=new ShapeFinder(i?[]:CascadeManager.p),a=0;a<=9;a++){var o=utils._i(globals.matrix.get(),a);o.forEach(function(i,n){var t=new PositionedBrick(o[n-1],new Position(n-1,a));4<n&&0==i&&0!=o[n-1]&&!e.gi(t)&&e.ei(t)})}CascadeManager.p=e.si()},ki(){var t=[];CascadeManager.p.forEach(function(i,n){globals.t.Bi(i),globals.t.move(MOVE.Oi,!0),globals.t.Ai()&&0!=i.Ei().length||t.push(n)}),t.forEach(function(i){CascadeManager.p.splice(i,1)}),0==CascadeManager.p.length&&globals.t.Pi()}};function Brick(i="rgb(79 49 97)",n="white"){this.value=1,this.Fi=i,this.borderColor=n,this.xi=!1}function PositionedBrick(i,n){this.ri=i,this.position=n}function Button(i,n){this.name=i,this.Ri=n,this.yi={touched:!1,Di:!1}}function Direction(i,n){this.Gi=parseInt(i),this.Ii=parseInt(n)}Brick.Vi={},Brick.prototype.valueOf=function(){return this.value},Brick.prototype.toString=function(){return this.value},Brick.prototype.oi=function(){return this.Fi},Brick.prototype.setFillColor=function(i){this.Fi=i},Brick.prototype.Ti=function(i){this.borderColor=i},Brick.prototype.Ci=function(){return this.borderColor},Brick.prototype.bi=function(i,n,t){var e,a,o,r,u=new Dimension(new Position(t,n-ui.dimensions.N*ui.dimensions.blockSize),ui.dimensions.blockSize,ui.dimensions.blockSize);Brick.Vi[this.Fi]?i.drawImage(Brick.Vi[this.Fi],u.x1,u.y1):((e=document.createElement("canvas")).width=ui.dimensions.blockSize,e.height=ui.dimensions.blockSize,a=e.getContext("2d"),o=new Image,r=utils.ji(this.Fi),o.onload=()=>{a.drawImage(o,0,0,o.width,o.height,0,0,e.width,e.height),a.fillStyle=`rgb(${r.r}, ${r.Ni}, ${r.b}, 0.7)`,a.fillRect(0,0,u.width,u.height),a.strokeStyle=this.borderColor,a.strokeRect(0,0,u.width,u.height),Brick.Vi[this.Fi]=e,this.bi(i,n,t)},o.src="img/brick.png")},Brick.prototype.Li=function(i,n,t){t=new Dimension(new Position(t*ui.dimensions.$+ui.dimensions.q,n*ui.dimensions.$+ui.dimensions.J),ui.dimensions.$,ui.dimensions.$);i.fillStyle=this.Fi,i.fillRect(t.x1,t.y1,t.width,t.height),i.strokeStyle=this.borderColor,i.strokeRect(t.x1,t.y1,t.width,t.height)},Object.defineProperty(PositionedBrick.prototype,"x",{get:function(){return this.position.x}}),Object.defineProperty(PositionedBrick.prototype,"y",{get:function(){return this.position.y}}),Object.defineProperty(PositionedBrick.prototype,"cx",{get:function(){return this.cposition.x}}),Object.defineProperty(PositionedBrick.prototype,"cy",{get:function(){return this.cposition.y}}),Button.prototype.Hi=function(i){return i.x>=this.Ri.x&&i.x<=this.Ri.x2&&i.y>=this.Ri.y&&i.y<=this.Ri.y2};var AnimManager={Wi:[],Vi:!(Button.prototype.bi=function(i=!1){var n,t,e,a=i?"touched":"untouched";return this.yi[a]||((n=document.createElement("canvas")).width=this.Ri.width+10,n.height=this.Ri.height+10,t=n.getContext("2d"),(e=new Image).onload=()=>{t.drawImage(e,0,0,400,400,0,0,this.Ri.width,this.Ri.height)},e.src=i?"img/"+this.name+"_touched.png":"img/"+this.name+".png",this.yi[a]=n),this.yi[a]}),Ui:!0,$i:{},qi:!1,zi:!1,Ji:!1,Yi:!1,Zi:!1,Xi:!1,Ki:!1,Qi:!1,init:function(){AnimManager.stop(),AnimManager.Zi=ui.elements.A.getContext("2d"),AnimManager.Xi=ui.elements._.getContext("2d"),AnimManager.Ki=ui.elements.S.getContext("2d"),ui.elements.S.width=ui.elements.S.width,ui.elements.S.height=ui.elements.S.height,AnimManager.Ki.fillStyle="black",AnimManager.Ki.fillRect(0,0,ui.elements.S.width,ui.elements.S.height),AnimManager.$i.nn=new Button("left",new Dimension(new Position(5,5),ui.dimensions.K,ui.dimensions.X-10)),AnimManager.$i.tn=new Button("right",new Dimension(new Position(2*ui.dimensions.K+15,5),ui.dimensions.K,ui.dimensions.X-10)),AnimManager.$i.en=new Button("up",new Dimension(new Position(ui.dimensions.K+10,5),ui.dimensions.K,(ui.dimensions.X-10)/2)),AnimManager.$i.an=new Button("down",new Dimension(new Position(ui.dimensions.K+10,(ui.dimensions.X-10)/2+10),ui.dimensions.K,ui.dimensions.X-60)),AnimManager.Ji=new FloatingScore,AnimManager.on()},on:function(){if(AnimManager.Qi=requestAnimationFrame(AnimManager.on),!globals.i.rn||!EventManager.un||globals.t.Ai()&&globals.t.Ai().sn()||(EventManager.un(),EventManager.un=!1),!1!==AnimManager.Yi&&window.performance.now()-AnimManager.Yi<globals.i.cn()/10)return!1;AnimManager.ln(),AnimManager.hn(),AnimManager.gn(),globals.i.fn(),globals.matrix.bi(AnimManager.Zi),AnimManager.Wi.forEach(i=>{AnimManager.Mn(i)}),AnimManager.Ji.bi(AnimManager.Zi),AnimManager.Yi=window.performance.now()},ln:function(){var t,e,a;AnimManager.Vi?AnimManager.Zi.drawImage(AnimManager.Vi,0,0):((t=document.createElement("canvas")).width=ui.dimensions.L,t.height=ui.dimensions.H,e=t.getContext("2d"),(a=new Image).onload=function(){if(e.drawImage(a,0,0,a.width,a.height,0,0,ui.dimensions.L,ui.dimensions.H),AnimManager.Ui){for(var i=0;i<=ui.dimensions.L;i+=ui.dimensions.blockSize)e.beginPath(),e.strokeStyle="rgb(240 240 240 )",e.moveTo(i,0),e.lineTo(i,ui.dimensions.H),e.stroke();for(var n=0;n<=ui.dimensions.H;n+=ui.dimensions.blockSize)e.beginPath(),e.strokeStyle="rgb(240 240 240 )",e.moveTo(0,n),e.lineTo(ui.dimensions.L,n),e.stroke()}AnimManager.Vi=t},a.src="img/background.jpg")},hn:function(){AnimManager.Xi.fillStyle="black",AnimManager.Xi.fillRect(0,0,ui.dimensions.W,ui.dimensions.U),AnimManager.Xi.font=ui.dimensions.Y+"px Terminal",AnimManager.Xi.fillStyle="white",AnimManager.Xi.fillText("SCORE: "+parseInt(globals.i.dn()).toLocaleString(),4,16),AnimManager.Xi.fillText("RECORD: "+parseInt(globals.i.mn()).toLocaleString(),4,34),AnimManager.Xi.fillText("LEVEL: "+globals.i.bn(),4,52);var i=AnimManager.qi;(i=globals.i.wn()&&globals.t.Ai()&&4<=globals.t.Ai().vn().x?globals.i.wn():i)?(i.pn(AnimManager.Xi),AnimManager.qi=i):ShapeFactory.create("EMPTY").pn(AnimManager.Xi)},gn:function(){Object.keys(AnimManager.$i).forEach(function(i){isNaN(i)&&AnimManager.Ki.drawImage(AnimManager.$i[i].bi(AnimManager.zi==i),AnimManager.$i[i].Ri.x,AnimManager.$i[i].Ri.y)})},Mn:function(i){for(var n=0;n<=10;n++){var t=new Brick("white");t.value=0,t.bi(AnimManager.Zi,i*ui.dimensions.blockSize,n*ui.dimensions.blockSize)}},Sn:function(i){AnimManager.Ui=i,AnimManager.An()},An:function(){AnimManager.Vi=!1},_n:function(i=[]){AnimManager.Wi=i,setTimeout(()=>{AnimManager.Wi=[]},100)},kn:function(i,n){AnimManager.Ji=new FloatingScore(i,n),setTimeout(()=>{AnimManager.Ji=new FloatingScore},2e3)},Bn:function(n,t){var e=!1;return Object.keys(AnimManager.$i).forEach(function(i){isNaN(i)&&AnimManager.$i[i].Hi(new Position(n,t))&&(e=i)}),AnimManager.zi=e,setTimeout(function(){AnimManager.zi=!1},100),e},stop:function(){this.Qi&&cancelAnimationFrame(AnimManager.Qi)}},ShapeFactory={On:{En:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],Pn:[[1,1],[1,1]],Fn:[[0,1,0],[1,1,1],[0,0,0]],xn:[[1,0,0],[1,1,1],[0,0,0]],Rn:[[0,0,1],[1,1,1],[0,0,0]],yn:[[0,1,1],[1,1,0],[0,0,0]],Dn:[[1,1,0],[0,1,1],[0,0,0]],EMPTY:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Gn:[[1,0,1],[1,1,1],[1,0,1]],In:[[0,1,0],[1,1,1],[0,1,0]],Vn:[[1,0,1],[1,0,1],[1,1,1]],Tn:[[1,1,1],[1,0,1],[1,1,1]],1:[[1]],2:[[0,0,0],[1,1,0],[0,0,0]],Cn:[[0,1],[1,0]]},jn:{En:"DarkCyan",xn:"blue",Pn:"Gold",Rn:"OrangeRed",yn:"green",Dn:"red",Fn:"magenta",EMPTY:"white"},create:function(e){for(var i=new Shape(e),n=ShapeFactory.On[e]||ShapeFactory.On.Pn,t=0;t<=utils.Nn(0,3);t++)n=utils.Ln(n);var a=[];return n.forEach(function(i,t){a[t]=[],i.forEach(function(i,n){a[t][n]=1==i?new Brick(ShapeFactory.jn[e]):i})}),i.setMatrix(a),i},ui:function(i,n=!1){for(var t=new Matrix,e=new Shape("B"),a=[],o=[],r=!1,u=!1,s=(t.init(),i.forEach(function(i){t.get()[i.x][i.y]=i.ri}),t.get().forEach(function(i,n){var t=[];i.forEach(function(i){t.push(i)}),-1<t.join("").indexOf("1")&&(!1===r&&(r=n),a.push(t))}),0),c=0;c<=9;c++){var l=utils._i(a,c),h=[];l.forEach(function(i){h.push(i)}),-1<h.join("").indexOf("1")&&(!1===u&&(u=c),h.forEach(function(i,n){void 0===o[n]&&(o[n]=[]),o[n][s]=i}),s++)}return e.setMatrix(o),e.setPosition(r,u),e.Hn=n,e}};let MOVE={Wn:new Direction(0,-1),Un:new Direction(0,1),$n:new Direction(-1,0),Oi:new Direction(1,0)};function ShapeManager(){this.qn=!1}ShapeManager.prototype.zn=function(i){this.qn=i,this.qn.Jn(),this.qn.setPosition(0,3),this.qn.Yn().forEach(function(i){globals.matrix.get()[i.x][i.y]=i.ri})},ShapeManager.prototype.pi=function(){return!1!==this.qn},ShapeManager.prototype.Ai=function(){return this.qn},ShapeManager.prototype.Bi=function(i){this.qn=i},ShapeManager.prototype.Zn=function(){this.qn=!1},ShapeManager.prototype.Pi=function(){return globals.matrix.Xn(function(i){var n=globals.i.Kn(i);globals.i.Qn().kn(n,Math.min(...i)),globals.i.Qn()._n(i),globals.i.it(i.length)})},ShapeManager.prototype.move=function(n,i=!1){if(!this.qn||!globals.i.rn)return!1;var t;this.nt(n)?(t=this.qn.vn(),this.qn.Yn().forEach(function(i){globals.matrix.get()[i.x][i.y]=0}),this.qn.setPosition(t.x+n.Gi,t.y+n.Ii),this.qn.Yn().forEach(function(i){globals.matrix.get()[i.x][i.y]=i.ri,MoveRegister.add(i.x,i.y,n)})):n==MOVE.Oi&&(this.qn.tt()?globals.i.et():(this.qn.Hn||this.Pi(),i||globals.i.ot(10),this.qn=!1))},ShapeManager.prototype.nt=function(n){var t,e;return!!this.qn&&(t=!0,e=this.qn,this.qn.Yn().forEach(function(i){!(0==i.y&&n==MOVE.Wn||9==i.y&&n==MOVE.Un||23==i.x&&n==MOVE.Oi)&&(1!=globals.matrix.get()[i.x+n.Gi][i.y+n.Ii]||e.fi(globals.matrix.get()[i.x+n.Gi][i.y+n.Ii]))||(t=!1)}),t)},ShapeManager.prototype.rt=function(){var n=!0,i=this.qn.rotate(),t=new Shape;return t.setMatrix(i),t.setPosition(this.qn.vn().x,this.qn.vn().y),t.Yn().forEach(function(i){!(9<i.y||i.y<0||23<i.x)&&(1!=globals.matrix.get()[i.x][i.y]||t.fi(globals.matrix.get()[i.x][i.y]))||(n=!1)}),n};var EventManager={un:!(ShapeManager.prototype.rotate=function(){"O"!=this.qn&&!1!==this.qn&&globals.i.rn&&this.rt()&&(this.qn.Yn().forEach(function(i){globals.matrix.get()[i.x][i.y]=0}),this.qn.setMatrix(this.qn.rotate()),this.qn.Yn().forEach(function(i){globals.matrix.get()[i.x][i.y]=i.ri,MoveRegister.add(i.x,i.y,MOVE.$n)}))}),ut:{st:MOVE.Wn,ct:MOVE.Un,lt:MOVE.Oi,ht:MOVE.$n},gt:{nn:MOVE.Wn,tn:MOVE.Un,an:MOVE.Oi,en:MOVE.$n},ft:function(i){i.preventDefault(),i.stopPropagation(),EventManager.Mt(EventManager.ut[i.key])},dt:function(i){i.preventDefault(),i.stopPropagation();var n=i.clientX||i.touches[0].clientX,i=i.clientY||i.touches[0].clientY;EventManager.Mt(EventManager.gt[AnimManager.Bn(n-ui.dimensions.ii.left,i-ui.dimensions.ii.top)])},Mt:function(i){let n=function(){};switch(i){case MOVE.Wn:case MOVE.Un:case MOVE.Oi:n=function(){globals.t.move(i)};break;case MOVE.$n:n=function(){globals.t.rotate()}}EventManager.un=n}},Shape=function(i){this.type=i,this.bt=[],this.Hn=!1,this.wt=!1,this.vt=new Position(0,0)},ui=(Shape.prototype.setMatrix=function(i){this.bt=i},Shape.prototype.Ei=function(){return this.bt},Shape.prototype.sn=function(){return this.Hn},Shape.prototype.Si=function(){return this.wt},Shape.prototype.Jn=function(){this.wt=!0},Shape.prototype.St=function(){var t,e=[];return 4==this.bt.length?e=this.bt:2==this.bt.length?e=[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]:(t=-1==utils._i(this.bt,0).indexOf(1),this.bt.forEach(function(i){var n=[];i.forEach(function(i){n.push(i)}),n=t?n.concat([0]):[0].concat(n),e.push(n)}),e.push([0,0,0,0])),e},Shape.prototype.Yn=function(){var e=[],a=this.vt;return this.bt.forEach(function(i,t){i.forEach(function(i,n){1==i&&e.push(new PositionedBrick(i,new Position(a.x+t,a.y+n)))})}),e},Shape.prototype.setPosition=function(i,n){this.vt=new Position(i,n)},Shape.prototype.vn=function(){return this.vt},Shape.prototype.fi=function(t){var e=!1;return this.bt.forEach(function(i,n){i.forEach(function(i,n){i===t&&(e=!0)})}),e},Shape.prototype.rotate=function(){return utils.Ln(this.bt)},Shape.prototype.tt=function(){var e=!1,a=this.vt;return this.bt.forEach(function(i,t){i.forEach(function(i,n){t+a.x==3&&(e=!0)})}),e},Shape.prototype.pn=function(e){this.St().forEach(function(i,t){i.forEach(function(i,n){new Brick(1==i?"gray":"rgb(216 217 232)","white").Li(e,t,n)})})},{dimensions:{},elements:{},init:function(){ui.dimensions=globals.o.dimensions,Object.keys(globals.o.elements).forEach(function(i){isNaN(i)&&(ui.elements[i]=document.getElementById(i))}),ui.dimensions.L=window.innerWidth-20-(window.innerWidth-20)%10,window.innerHeight-210<ui.dimensions.L/10*(24-ui.dimensions.N)&&(ui.dimensions.L=(window.innerHeight-210-(window.innerHeight-210)%(24-ui.dimensions.N))/(24-ui.dimensions.N)*10),ui.dimensions.blockSize=ui.dimensions.L/10,ui.dimensions.H=ui.dimensions.blockSize*(24-ui.dimensions.N),ui.dimensions.W=ui.dimensions.L,ui.dimensions.q=ui.dimensions.L-53,ui.dimensions.Z=ui.dimensions.W,ui.dimensions.K=ui.dimensions.Z/3-7,ui.elements.A.width=ui.dimensions.L,ui.elements.A.height=ui.dimensions.H,ui.elements._.width=ui.dimensions.W,ui.elements._.height=ui.dimensions.U,ui.elements.k.style.width=ui.dimensions.L+"px",ui.elements.S.width=ui.dimensions.Z,ui.elements.S.height=ui.dimensions.X,ui.dimensions.Y=parseInt(16/217*ui.dimensions.q),ui.dimensions.Y=16<ui.dimensions.Y?16:ui.dimensions.Y,ui.dimensions.ii=ui.elements.S.getBoundingClientRect(),ui.elements.S.style.backgroundColor="black",utils.At()?(ui.elements.S.addEventListener("touchstart",EventManager.dt,{passive:!1}),ui.elements.S.style.display="block"):(window.addEventListener("keydown",EventManager.ft,{passive:!1}),ui.elements.S.style.display="none"),ui.elements.B.addEventListener("click",ui._t),ui.elements.O.addEventListener("click",globals.i.pause),ui.elements.P.addEventListener("click",globals.i.continue),ui.Sn(localStorage.getItem("tetris_grid_needed")&&1==localStorage.getItem("tetris_grid_needed")),ui.elements.F.addEventListener("click",function(){ui.Sn(!0)}),ui.elements.R.addEventListener("click",function(){ui.Sn(!1)}),ui.elements.T.addEventListener("click",function(){globals.i.kt=1==ui.elements.C.value,globals.i.start(ui.elements.j.value<=15&&0<ui.elements.j.value?ui.elements.j.value:0),ui.Bt()}),ui._t(ui.elements.C.value)},Ot:function(){var i=ui.Et(ui.elements.A,ui.elements.D);ui.elements.I.src="img/dog_laugh.gif",ui.elements.I.style.width=i.width-50+"px",ui.elements.O.style.display="none"},Pt:function(){ui.elements.O.style.display="none",ui.elements.P.style.display="",ui.elements.B.style.display="none",ui.Et(ui.elements.A,ui.elements.G),ui.elements.G.style.lineHeight=ui.elements.G.style.height},Ft:function(){ui.elements.O.style.display="",ui.elements.P.style.display="none",ui.elements.B.style.display="",ui.elements.G.style.display="none"},_t:function(i=0){globals.i.rn=!1,ui.elements.O.style.display="none",ui.elements.B.style.display="none",ui.elements.P.style.display="none",ui.elements.D.style.display="none",ui.Et(ui.elements.A,ui.elements.V),ui.elements.V.style.lineHeight=ui.elements.V.style.height,ui.elements.V.style.verticalAlign="middle",ui.elements.V.style.textAlign="center";var n=0<(n=0<i?i:localStorage.getItem("tetris_reached_level"))&&n<=15?n:0;for(let i=ui.elements.j.options.length-1;0<=i;i--)ui.elements.j.remove(i);for(let i=0;i<=n;i++){var t=document.createElement("option");t.value=i,t.text="Level "+i,ui.elements.j.add(t)}},Bt:function(){ui.elements.O.style.display="",ui.elements.B.style.display="",ui.elements.P.style.display="none",ui.elements.D.style.display="none",ui.elements.V.style.display="none"},Sn:function(i){i?(ui.elements.F.style.display="none",ui.elements.R.style.display="",globals.i.Qn().Sn(!0),localStorage.setItem("tetris_grid_needed",1)):(ui.elements.F.style.display="",ui.elements.R.style.display="none",globals.i.Qn().Sn(!1),localStorage.setItem("tetris_grid_needed",0))},Et:function(i,n){i=i.getBoundingClientRect();return n.style.top=i.top,n.style.left=i.left,n.style.width=i.width+"px",n.style.height=i.height+"px",n.style.display="block",i}});function Game(){this.kt=!1,this.l=!1,this.level=0,this.mi=0,this.xt=!1,this.Rt=0,this.yt=AnimManager,this.rn=!1,this.Dt=window.performance.now(),this.Gt=window.performance.now()}function Matrix(){this.bt=[],this.init()}Game.prototype.fn=function(){return!(!globals.i.rn||window.performance.now()-this.Dt<this.cn())&&(this.kt&&(CascadeManager.vi(),0<CascadeManager.wi().length)?(CascadeManager.ki(),this.Dt=window.performance.now(),!1):(globals.t.pi()||(0==globals.i.xt&&(globals.i.xt=ShapeFactory.create(utils.It())),globals.t.zn(globals.i.xt),globals.i.xt=ShapeFactory.create(utils.It())),globals.t.Ai().sn()||globals.t.move(MOVE.Oi),0<globals.i.Rt&&globals.i.Rt>=globals.g[this.bn()+1]&&(globals.i.Rt=0,globals.i.Vt()),void(this.Dt=window.performance.now())))},Game.prototype.cn=function(){return globals.h[this.level]},Game.prototype.start=function(i=0){this.init(i),(globals.i=this).rn=!0},Game.prototype.init=function(i=0){this.level=parseInt(i),this.mi=0,this.xt=!1,this.Rt=0,this.rn=!1,this.Dt=window.performance.now(),globals.t=new ShapeManager,globals.matrix=new Matrix,ui.init(),AnimManager.init()},Game.prototype.Qn=function(){return this.yt},Game.prototype.pause=function(){globals.i.rn=!1,ui.Pt()},Game.prototype.continue=function(){globals.i.rn=!0,ui.Ft()},Game.prototype.bn=function(){return this.level},Game.prototype.Vt=function(){this.level<15&&(this.level=this.level+1),localStorage.setItem("tetris_reached_level",this.level)},Game.prototype.ot=function(i){this.mi=this.mi+i,this.mi>localStorage.getItem("tetris_record")&&localStorage.setItem("tetris_record",this.mi)},Game.prototype.dn=function(){return this.mi},Game.prototype.mn=function(){var i=localStorage.getItem("tetris_record")?localStorage.getItem("tetris_record"):0;return this.mi>i?this.mi:i},Game.prototype.et=function(){this.rn=!1,globals.t.Zn(),this.Qn().stop(),(!localStorage.getItem("tetris_record")||parseInt(this.mi)>parseInt(localStorage.getItem("tetris_record")))&&localStorage.setItem("tetris_record",this.mi),ui.Ot()},Game.prototype.wn=function(){return this.xt},Game.prototype.it=function(i){this.Rt=this.Rt+i},Game.prototype.Kn=function(i){let n=[40,100,300,1200][i.length-1]*(this.bn()+1);return globals.matrix.Tt()&&(n+=5e3*(this.bn()+1)),this.ot(n),n},Matrix.prototype.get=function(){return this.bt},Matrix.prototype.init=function(){this.bt=[],this.Ct=[];var i={length:10};Array.from({length:24},()=>Array.from(i,()=>0)).forEach((i,t)=>{this.bt[t]=[],i.forEach((i,n)=>{this.bt[t][n]=0})})},Matrix.prototype.Xn=function(i){var t=[],e=[];return this.bt.forEach((i,n)=>{-1==i.join("").indexOf("0")?(globals.i.kt?t.push(new Array(10).fill(0,0,10)):t=[new Array(10).fill(0,0,10)].concat(t),e.push(n)):t.push(i)}),0<e.length&&i(e),this.bt=t,e.length},Matrix.prototype.bi=function(a){this.get().forEach(function(i,e){i.forEach(function(i,n){var t;3<e&&1==i&&((t=MoveRegister.get(e,n))?(t.direction==MOVE.Oi?i.bi(a,(e-1)*ui.dimensions.blockSize+ui.dimensions.blockSize/10*(10-t.count),n*ui.dimensions.blockSize):t.direction==MOVE.Wn?i.bi(a,e*ui.dimensions.blockSize,(n+1)*ui.dimensions.blockSize-ui.dimensions.blockSize/10*(10-t.count)):t.direction==MOVE.Un?i.bi(a,e*ui.dimensions.blockSize,(n-1)*ui.dimensions.blockSize+ui.dimensions.blockSize/10*(10-t.count)):t.direction==MOVE.$n&&i.bi(a,e*ui.dimensions.blockSize,n*ui.dimensions.blockSize),MoveRegister.di(e,n)):i.bi(a,e*ui.dimensions.blockSize,n*ui.dimensions.blockSize))})})},Matrix.prototype.Tt=function(){var t=!0;return this.get().forEach((i,n)=>{-1<i.join("").indexOf("1")&&3<n&&(t=!1)}),t};var utils={jt:[],It:function(){return 0==utils.jt.length&&(utils.jt=(globals.i.l?globals.l.concat(globals.u):globals.u).map(i=>({sort:Math.random(),value:i})).sort((i,n)=>i.sort-n.sort).map(i=>i.value)),utils.jt.pop()},Nn:function(i,n){return Math.floor(Math.random()*(n-i+1))+i},_i:function(i,n){return i.map(i=>i[n])},Nt:function(i,n){return i[n].map(i=>i)},Lt:function(n){return new Promise(i=>setTimeout(i,n))},Ht:function(i,n,t=1,e){for(var a=1==t?i:n;1==t?a<n:i<a;a=1==t?a+1:a-1)e(a)},Ln:function(t){return t.map((i,n)=>t.map(i=>i[n]).reverse())},ji:function(i){var n=document.createElement("canvas").getContext("2d");return n.fillStyle=i,utils.Wt(n.fillStyle)},Wt:function(i){i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return i?{r:parseInt(i[1],16),Ni:parseInt(i[2],16),b:parseInt(i[3],16)}:null},At:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}};window.onload=function(){globals.i=new Game,globals.i.init()},window.onresize=function(){globals.i=new Game,globals.i.init(),globals.i.Qn().An()};